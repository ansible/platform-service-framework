# WARNING: DO NOT EDIT THIS FILE, IT IS MANAGED BY ANSIBLE-SERVICES-FRAMEWORK.
"""
URL configuration for {{project_name}}.

This file is managed by the Ansible Services Framework

## Loading order

1. Load the base URL patterns (including DAB)
2. Load the URL patterns for each app
3. Load the debug and development URLS

"""

import importlib

from ansible_base.lib.dynamic_config.dynamic_urls import (
    api_urls,  # type: ignore
    api_version_urls,  # type: ignore
    root_urls,  # type: ignore
)
from ansible_base.rbac.service_api.urls import rbac_service_urls
from ansible_base.resource_registry.urls import urlpatterns as resource_api_urls
from django.conf import settings
from django.conf.urls.static import static
from django.urls import include, path

from apps.core.views import APIRootView

urlpatterns = []

# Django Ansible Base URLs
urlpatterns += [
    path('v1/', include(api_version_urls)),
    path('v1/', include(resource_api_urls)),
    path('v1/', include(rbac_service_urls)),
    path('', include(root_urls)),
    path('', include(api_urls)),
]

# Override empty router views from DAB with dynamic API root
urlpatterns += [
    path('v1/', APIRootView.as_view(), name='v1-index'),
]

# Extend URL patterns for each app
for app in settings.LOADED_APPS:
    app_name = app.split(".")[-1]
    url_module_path = f"{app}.urls"
    urls = importlib.import_module(url_module_path)
    if patterns := getattr(urls, "urlpatterns", None):
        # Core app URLs are registered at root level (ping, health, etc.)
        if app_name == "core":
            urlpatterns.append(path("", include(url_module_path)))
        else:
            urlpatterns.append(path(f"{app_name}/", include(url_module_path)))

# Debug and Development URLS
if not settings.DYNACONF.get("IS_RUNNING_TESTS") and settings.DYNACONF.get("DEBUG"):
    from debug_toolbar.toolbar import debug_toolbar_urls  # noqa

    urlpatterns.extend(debug_toolbar_urls())

# Static URL required to serve DRF Browsable API
urlpatterns += static(settings.STATIC_URL, document_root=settings.STATIC_ROOT)